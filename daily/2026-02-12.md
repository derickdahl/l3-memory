# 2026-02-12 - NPI Tracker EPR PDF Implementation

## Session Summary
Fixed EPR (Ex Parte Reexamination) petition PDF generation for npi-tracker project. Went through multiple iterations to get proper filing format.

## Key Technical Decisions

### PDF Generation Approach Evolution
1. **html2pdf.js (client-side)** → Freezing on large documents ❌
2. **pdfkit (server-side)** → Performance issues on Vercel serverless ❌
3. **jsPDF (server-side)** → Final solution ✅
   - Lightweight, works well in serverless
   - Supports proper text formatting and pagination

### Official EPA Format Requirements (37 CFR 1.510 + MPEP 2214)
The PDF must include exactly these sections:
- **I. Statement of Substantial New Question of Patentability** - summarize why the prior art raises new questions
- **II. Identification and Application of Prior Art** - list all references with relevance and confidence
- **III. Detailed Claim-by-Claim Analysis** - element-by-element breakdown showing how prior art covers each claim element
- **IV. Conclusion** - summary statement requesting reexamination

### Format Specifications
- Font: **Courier** (standard legal/USPTO format, NOT Times New Roman)
- Page size: **8.5" x 11" letter**
- Margins: **1" left/right, 1" top, 0.5" bottom**
- Line spacing: **Single space (0.15" per line)**
- Page numbers on footer
- Signature block with date

## Code Changes Made
1. **EPRDownloadButton.tsx** - switched from html2pdf to fetch API call to server endpoint
2. **src/app/api/epr/[id]/download/route.ts** - complete rewrite using jsPDF with proper USPTO format
3. **EPRDocument.tsx** - removed duplicate "NPI Patent Tracker" header (was appearing twice)

## Important References
- **37 CFR 1.510** - Requirements for EPR requests
- **MPEP § 2214** - Content of request for ex parte reexamination
- **MPEP § 2290** - Format of reexamination certificate (this is OUTPUT, not INPUT)

## Next Steps
- Test final PDF to ensure no content is missing and format matches official requirements
- May need to adjust element-by-element table formatting if too dense
